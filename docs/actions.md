# Боевые действия

Конфиги записываются в `config/more/actions.json` в виде списка объектов.

Сразу начнем с примера одного из таких объектов:

```json
{
  "id": "hard_hit",
  "title": "Сильный удар",
  "tags": [
    "melee"
  ],
  "combo": [],
  "score": [
    "3d7-3",
    "STR"
  ],
  "target": [
    "damage",
    "damage+:5"
  ],
  "self": [
    "score*:0.9"
  ]
}
```

Как можно заметить, действие разделено на целых семь разных компонентов:
- `id` - уникалый идентификатор этого действия;
- `title` - название действия которое видит игрок. Если название начинается с точки, то оно рассматривается как ключ для строки из языковых файлов;
- `tags` - список тегов данного действия, они описывают какие-то особые свойства действия в целом;
- `combo` - список из идентификаторов действий, которые необходимо выполнить для активации данного действия;
- `score` - список из бросков и стат, на основе которых вычисляется результат действия;
- `target` - список из эффектов, которые применяются относительно цели;
- `self` - то же самое, но относительно себя.

## Тэги

Науке известны следующие тэги:
- `melee, ranged, magical, intellectual` - Устанавливают тип действия. Защищаться можно только действием того же типа что и атака.
- `defencive` - Отмечает действие как оборонительное.
- `none, equip, reload` - Разные пассивные тэги для действий доступных по-умолчанию. Не трогай их.

## Скоры

Бывают такими:
- `3d7-3`
- `STR, END, REF, PER, SPR, WIL, INT, DET` - равны значению абилки персонажа плюс его модификатор абилки.

## Эффекты

Наконец самое сладенькое. Хоть все эффекты это эффекты, но их можно разделить на три группы по степени усложнения:
- Простые эффекты
- Динамические эффекты
- Баффы

Эффекты также можно разделить еще на две группы по моменту их применения:
- Применяемые во время подсчета счета
- Применяемые по резульатам хода

Все эффекты применяются последовательно, так-что можно делать нехитрые математические штуки с уроном или счетом.

Но прежде чем мы начнем разбирательства определим термины:
- Сторона - просто название для одного из двух бойцов;
- Цель - боец, в зависимости от того, в каком из списков находится эффект (`target` или `self`);
- Другая сторона - другой боец который не Цель;

### Простые эффекты

Простые эффекты это просто. Настолько просто, что единственным работающим, на данный момент, простым эффектом является `damage`.

Чтобы добавить простой эффект нужно всего лишь написать его имя.

- `damage` - добавляет цели урон, который нанесла другая сторона. Если добавить эффект несколько раз, то он будет дублироваться.

На этом все.

### Динамические эффекты

Это эффекты в которые можно вводить разные значения. Название эффекта и его аргументы отделяются друг от друга двоеточиями.

Например:
`damage+:5` - добавит 5 к урону, получаемому целью.

Типы принимаемых значений:
- `INT` - целочисленное число, т.е. без запятой;
- `FLOAT` - число с плавающей запятой, т.е. с запятой;
- `STRING` - строка для непонятных значений;
- `EFFECT` - эффект. Применяется только в баффах о которых дальше.

Список эффектов счета:
- `ability:STRING:FLOAT` - добавляет значение абилки умноженное на модификатор;
- `score+:INT` - добавляет число к счету цели;
- `score*:FLOAT` - умножает на число весь текущий счет цели;
- `min_score:INT` - если счет цели меньше указанного числа, то его действие будет неудачным;
- `mod ability:STRING:INT` - добавляет стакающийся модификатор статы. Применяется всегда перед другими эффектами счета.

Список эффектов урона:
- `damage+:INT` - наносит цели блокируемый броней урон;
- `raw damage+:INT` - наносит неблокируемый урон;
- `damage*:FLOAT` - умножает на число весь текущий получаемый целью урон;
- `other damage+:INT` - наносит другой стороне блокируемый броней урон от имени цели;
- `other damage*:FLOAT` - умножает на число весь текущий получаемый другой стороной урон;
- `heal:INT` - лечит цель. Применяется до нанесения урона.

### Баффы

На самом деле все баффы это один единственный динамический эффект.

Пример баффа "наносит 1 урона в ход в течении 2 ходов": `buff:0:2:stack:damage+:1`.

Препарируем его:
```
buff - название эффекта баффа
  :0 - пауза перед активацией
  :2 - кол-во активаций
  :stack - способ обновления баффа
  :damage+:1 - эффект баффа
```

Баффы вызываются два раза, точно также как и другие эффекты - во время формирования счета и во время применения действия.
После каждого успешного действия они обновляются, уменьшая сначала счетчик паузы, а потом счетчик активаций. Когда они оба равны нулю, то бафф удаляется.

Если бафф накладывается на игрока и при этом у него уже есть бафф с точно такм же эффектом, то задействуется логика обновления баффа.
Способы обновления баффа:
- `extend` - к кол-ву активаций имеющегося баффа добавляются активации нового баффа;
- `replace` - имеющийся бафф полностью заменяется новым баффом;
- `stack` - новый бафф добавляется, не затрагивая имеющиеся.

Вспомогательные эффекты:
- `role:STRING:EFFECT` - ограничивает применение эффекта только для определенного типа хода. Значения арумента: `offence` или `defence`;
